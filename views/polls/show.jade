extends ../layout

block content
  script(type='text/javascript').
    var sockjs_url = '/multiplex';
    var sockjs = new SockJS(sockjs_url);
    var multiplexer = new WebSocketMultiplex(sockjs);
    var pollChannel = multiplexer.channel('#{poll.uri}');
    pollChannel.onopen = function(){ alert('channel opened')}
    pollChannel.onmessage = function(msg){ alert('msg received: ' + JSON.stringify(msg))}
    pollChannel.onclose = function(){ alert('channel closed')}
  p
    h2 #{poll.name}?

    if poll.choices
      dl
        each choice in poll.choices
          - var votes = poll.votesFor(choice)
          dt #{choice.text}
          dd #{votes.total} (#{votes.percentile}%)
  p
  h4 Voting ends #{poll.expires}
  p
    if poll.votes.length == 0
      h4 There are no votes yet. Be the <a href="#{poll.uri}/vote">first</a>?
    else
      h4 Details
      ul
        each vote in poll.votes
          li= vote.voter + " voted " + poll.textFor(vote.choice) + " at " + vote.createdAt

